$OpenBSD: patch-CMakeLists_txt,v 1.8 2021/03/02 17:31:24 sthen Exp $

Index: CMakeLists.txt
--- CMakeLists.txt.orig
+++ CMakeLists.txt
@@ -198,12 +198,14 @@ if(${CMAKE_SYSTEM_NAME} MATCHES "BSD")
 	set(BSD TRUE)
 	if(${CMAKE_SYSTEM_NAME} MATCHES "FreeBSD")
 		set(FREEBSD TRUE)
+		set(EPOLLSHIM TRUE)
 	endif()
 	if(${CMAKE_SYSTEM_NAME} MATCHES "kFreeBSD")
 		set(KFREEBSD TRUE)
 	endif()
 	if(${CMAKE_SYSTEM_NAME} MATCHES "OpenBSD")
 		set(OPENBSD TRUE)
+		set(EPOLLSHIM TRUE)
 	endif()
 endif()
 
@@ -212,7 +214,7 @@ if(${CMAKE_SYSTEM_NAME} MATCHES "DragonFly")
 	set(FREEBSD TRUE)
 endif()
 
-if(FREEBSD)
+if(EPOLLSHIM)
 	find_path(EPOLLSHIM_INCLUDE_DIR NAMES sys/epoll.h sys/timerfd.h HINTS /usr/local/include/libepoll-shim)
 	find_library(EPOLLSHIM_LIBS NAMES epoll-shim libepoll-shim HINTS /usr/local/lib)
 endif()
@@ -528,7 +530,7 @@ add_definitions(-DWINPR_EXPORTS -DFREERDP_EXPORTS)
 if(NOT IOS)
 	check_include_files(fcntl.h HAVE_FCNTL_H)
 	check_include_files(unistd.h HAVE_UNISTD_H)
-	check_include_files(execinfo.h HAVE_EXECINFO_H)
+	#check_include_files(execinfo.h HAVE_EXECINFO_H)
 	check_include_files(inttypes.h HAVE_INTTYPES_H)
 	check_include_files(sys/modem.h HAVE_SYS_MODEM_H)
 	check_include_files(sys/filio.h HAVE_SYS_FILIO_H)
@@ -580,7 +582,7 @@ if(OPENBSD)
 	set(WITH_MANPAGES "ON")
 	set(WITH_ALSA "OFF")
 	set(WITH_PULSE "OFF")
-	set(WITH_OSS "ON")
+	set(WITH_OSS "OFF")
 	set(WITH_WAYLAND "OFF")
 endif()
 
@@ -635,11 +637,11 @@ if(UNIX OR CYGWIN)
 	if (HAVE_SYS_EVENTFD_H)
 		check_symbol_exists(eventfd_read sys/eventfd.h WITH_EVENTFD_READ_WRITE)
 	endif()
-	if (FREEBSD)
+	if (EPOLLSHIM)
 		list(APPEND CMAKE_REQUIRED_INCLUDES ${EPOLLSHIM_INCLUDE_DIR})
 	endif()
 	check_include_files(sys/timerfd.h HAVE_SYS_TIMERFD_H)
-	if (FREEBSD)
+	if (EPOLLSHIM)
 		list(REMOVE_ITEM CMAKE_REQUIRED_INCLUDES ${EPOLLSHIM_INCLUDE_DIR})
 	endif()
 	check_include_files(poll.h HAVE_POLL_H)
