$OpenBSD: patch-editor_delayed-setting-view_vala,v 1.1 2021/03/01 09:52:31 ajacoutot Exp $

From fdc90849223649509424bbefe14990de71db2b2b Mon Sep 17 00:00:00 2001
From: Rico Tzschichholz <ricotz@ubuntu.com>
Date: Sat, 16 Jan 2021 13:26:32 +0100
Subject: [PATCH] Don't alter or try to write GtkChild fields

Index: editor/delayed-setting-view.vala
--- editor/delayed-setting-view.vala.orig
+++ editor/delayed-setting-view.vala
@@ -41,24 +41,24 @@ private class DelayedSettingView : OverlayedListRow
         {
             // at row creation, key is never ghost
             _update_dconf_key_current_value (key_value,
-                                         ref key_value_label,
-                                         ref key_value_default);
+                                             key_value_label,
+                                             key_value_default);
 
             _update_dconf_key_planned_value (cool_planned_value,
-                                         ref planned_value_label,
-                                         ref planned_value_default);
+                                             planned_value_label,
+                                             planned_value_default);
         }
         else
         {
             _update_gsettings_key_current_value (key_value,
                                                  has_schema_and_is_default,
-                                             ref key_value_label,
-                                             ref key_value_default);
+                                                 key_value_label,
+                                                 key_value_default);
 
             _update_gsettings_key_planned_value (cool_planned_value,
                                                  (!) cool_default_value,
-                                             ref planned_value_label,
-                                             ref planned_value_default);
+                                                 planned_value_label,
+                                                 planned_value_default);
         }
     }
 
@@ -74,23 +74,23 @@ private class DelayedSettingView : OverlayedListRow
 
     private static inline void _update_gsettings_key_planned_value (string? cool_planned_value,
                                                                     string  cool_default_value,
-                                                                ref Label   planned_value_label,
-                                                                ref Label   planned_value_default)
+                                                                    Label   planned_value_label,
+                                                                    Label   planned_value_default)
     {
         bool is_default = cool_planned_value == null;
         planned_value_label.label = is_default ? cool_default_value : (!) cool_planned_value;
-        update_value_default_label (is_default, ref planned_value_default);
+        update_value_default_label (is_default, planned_value_default);
     }
 
     private static inline void _update_dconf_key_planned_value (string? cool_planned_value,
-                                                            ref Label   planned_value_label,
-                                                            ref Label   planned_value_default)
+                                                                Label   planned_value_label,
+                                                                Label   planned_value_default)
     {
         if (cool_planned_value == null)
-            update_labels_dconf_key_erased (ref planned_value_label, ref planned_value_default);
+            update_labels_dconf_key_erased (planned_value_label, planned_value_default);
         else
             update_labels_dconf_key_values ((!) cool_planned_value,
-                                            ref planned_value_label, ref planned_value_default);
+                                            planned_value_label, planned_value_default);
     }
 
     /*\
@@ -99,37 +99,37 @@ private class DelayedSettingView : OverlayedListRow
 
     internal void update_gsettings_key_current_value (Variant key_value, bool is_default)
     {
-        _update_gsettings_key_current_value (key_value, is_default, ref key_value_label, ref key_value_default);
+        _update_gsettings_key_current_value (key_value, is_default, key_value_label, key_value_default);
     }
     private static void _update_gsettings_key_current_value (Variant key_value,
                                                              bool    is_default,
-                                                         ref Label   key_value_label,
-                                                         ref Label   key_value_default)
+                                                             Label   key_value_label,
+                                                             Label   key_value_default)
     {
         key_value_label.label = Key.cool_text_value_from_variant (key_value);
-        update_value_default_label (is_default, ref key_value_default);
+        update_value_default_label (is_default, key_value_default);
     }
 
     internal void update_dconf_key_current_value (Variant? key_value_or_null)
     {
-        _update_dconf_key_current_value (key_value_or_null, ref key_value_label, ref key_value_default);
+        _update_dconf_key_current_value (key_value_or_null, key_value_label, key_value_default);
     }
     private static void _update_dconf_key_current_value (Variant? key_value_or_null,
-                                                     ref Label    key_value_label,
-                                                     ref Label    key_value_default)
+                                                         Label    key_value_label,
+                                                         Label    key_value_default)
     {
         if (key_value_or_null == null)
-            update_labels_dconf_key_erased (ref key_value_label, ref key_value_default);
+            update_labels_dconf_key_erased (key_value_label, key_value_default);
         else
             update_labels_dconf_key_values (Key.cool_text_value_from_variant ((!) key_value_or_null),
-                                            ref key_value_label, ref key_value_default);
+                                            key_value_label, key_value_default);
     }
 
     /*\
     * * common utilities
     \*/
 
-    private static void update_labels_dconf_key_erased (ref Label value_label, ref Label value_default)
+    private static void update_labels_dconf_key_erased (Label value_label, Label value_default)
     {
         value_label.visible = false;
         /* Translators: displayed in the list of pending changes (could be an in-window panel, or in the popover of the bottom bar); for dconf keys */
@@ -137,14 +137,14 @@ private class DelayedSettingView : OverlayedListRow
         value_default.visible = true;
     }
 
-    private static void update_labels_dconf_key_values (string key_value, ref Label value_label, ref Label value_default)
+    private static void update_labels_dconf_key_values (string key_value, Label value_label, Label value_default)
     {
         value_default.visible = false;
         value_label.label = key_value;  // TODO move Key.cool_text_value_from_variant here?
         value_label.visible = true;
     }
 
-    private static void update_value_default_label (bool is_default, ref Label value_default)
+    private static void update_value_default_label (bool is_default, Label value_default)
     {
         if (is_default)
             /* Translators: displayed in the list of pending changes (could be an in-window panel, or in the popover of the bottom bar); for gsettings keys */
